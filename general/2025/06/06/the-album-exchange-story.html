<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<!-- Favicon -->
		<link
			rel="icon"
			type="image/png"
			href="/favicon-96x96.png"
			sizes="96x96"
		/>
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<link rel="shortcut icon" href="/favicon.ico" />
		<link
			rel="apple-touch-icon"
			sizes="180x180"
			href="/apple-touch-icon.png"
		/>
		<meta name="apple-mobile-web-app-title" content="bhav" />
		<link rel="manifest" href="/site.webmanifest" />

		<!-- Primary Meta Tags -->
		<meta
			name="keywords"
			content="portfolio, photography, developer, writer"
		/>

		<!-- Open Graph / Facebook -->
		<meta property="og:image" content="https://whybhav.in/social-preview.png" />

		<!-- Twitter -->
		<meta property="twitter:card" content="summary_large_image" />
		<meta
			property="twitter:image"
			content="https://whybhav.in/social-preview.png"
		/>

		<!-- Theme Color for mobile browsers -->
		<meta name="theme-color" content="#18181B" />

		<!-- Performance optimizations -->
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="dns-prefetch" href="https://fonts.googleapis.com" />
		<title>
			The Album Exchange Story | whybhav
		</title>
		<link
			rel="stylesheet"
			href="/assets/css/main.css"
		/>
		  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>The Album Exchange Story | whybhav</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="The Album Exchange Story" />
<meta name="author" content="Vaibhav Achuthananda" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="During the height of Covid, a bunch of brave people gathered around a table and said, “Enough is enough!” and decided to take matters into their own hands. So they made a Discord channel to pair up random people and recommend music, and this was called Album Exchange." />
<meta property="og:description" content="During the height of Covid, a bunch of brave people gathered around a table and said, “Enough is enough!” and decided to take matters into their own hands. So they made a Discord channel to pair up random people and recommend music, and this was called Album Exchange." />
<link rel="canonical" href="https://whybhav.in/general/2025/06/06/the-album-exchange-story.html" />
<meta property="og:url" content="https://whybhav.in/general/2025/06/06/the-album-exchange-story.html" />
<meta property="og:site_name" content="whybhav" />
<meta property="og:image" content="https://whybhav.in/social-preview.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-06-06T20:32:00+00:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://whybhav.in/social-preview.png" />
<meta property="twitter:title" content="The Album Exchange Story" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Vaibhav Achuthananda"},"dateModified":"2025-06-06T20:32:00+00:00","datePublished":"2025-06-06T20:32:00+00:00","description":"During the height of Covid, a bunch of brave people gathered around a table and said, “Enough is enough!” and decided to take matters into their own hands. So they made a Discord channel to pair up random people and recommend music, and this was called Album Exchange.","headline":"The Album Exchange Story","image":"https://whybhav.in/social-preview.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://whybhav.in/general/2025/06/06/the-album-exchange-story.html"},"url":"https://whybhav.in/general/2025/06/06/the-album-exchange-story.html"}</script>
<!-- End Jekyll SEO tag -->

	</head>
	<body>
		<div class="container">
			<header class="site-header">
	<nav class="site-nav">
		<div class="menu-toggle">
			<span></span>
			<span></span>
			<span></span>
		</div>
		<ul>
            
            <li><a href="/" >home</a></li>
            
            <li><a href="/now/" >now</a></li>
            
            <li><a href="/writings/" >writings</a></li>
            
            <li><a href="/photos/" >photos</a></li>
            
            <li><a href="/contact/" >contact</a></li>
            
        </ul>
	</nav>
</header>
			<main><article class="post">
	<header class="post-header">
		<h1 class="post-title">The Album Exchange Story</h1>
		<p class="post-meta">
			<time datetime="2025-06-06T20:32:00+00:00">
				June 06, 2025
			</time>
			
			<span class="post-tags">
				
				<a
					href="/writings/tags/album-exchange"
					class="tag"
					>album-exchange</a
				>
				
				<a
					href="/writings/tags/music"
					class="tag"
					>music</a
				>
				
				<a
					href="/writings/tags/spotify"
					class="tag"
					>spotify</a
				>
				
			</span>
			
		</p>
	</header>
	<div class="post-content"><p>During the height of Covid, a bunch of brave people gathered around a table and said, “Enough is enough!” and decided to take matters into their own hands. So they made a Discord channel to pair up random people and recommend music, and this was called Album Exchange.</p>

<p>That no longer exists, and Spotify’s recommendation algorithm—pardon my language—sucks ass, which is why I have decided to be brave and build a website to get album recommendations.</p>

<figure>
  <img src="/assets/images/blog/album-exchange.png" alt="Social preview for Album Exchange" />
  <figcaption>Album Exchange</figcaption>
</figure>

<h2 id="the-core-idea">The Core Idea</h2>

<p>The concept is intentionally simple:</p>

<ul>
  <li>I feature a weekly album pick on the homepage</li>
  <li>You can submit one album recommendation per week</li>
  <li>Your submission automatically becomes a playlist on my Spotify account</li>
  <li>Everyone can browse the gallery of all submitted albums</li>
  <li>The site shows what I’m currently listening to (when I am)</li>
</ul>

<h2 id="technical-challenges">Technical Challenges</h2>

<h3 id="the-spotify-api">The Spotify API</h3>

<p>I have never used Spotify’s API before, so I had to learn to do a few things like:</p>

<ol>
  <li>Fetch album details for display</li>
  <li>Create playlists automatically from submissions</li>
  <li>Show my current listening status</li>
  <li>Handle rate limits gracefully</li>
</ol>

<p>The rate limit challenge was enjoyable. Spotify is generous with its limits, but you can hit walls quickly when fetching album art and details for every submission. I ended up implementing a caching strategy with multiple fallbacks:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// cache album details for 24h</span>
<span class="kd">const</span> <span class="nx">albumDetailsCache</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Map</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">ALBUM_CACHE_DURATION</span> <span class="o">=</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">;</span>

<span class="c1">// retry logic with exponential backoff</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nf">fetchWithRetry</span><span class="p">(</span><span class="nx">fetchFn</span><span class="p">,</span> <span class="nx">maxRetries</span> <span class="o">=</span> <span class="nx">MAX_RETRIES</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">let</span> <span class="nx">retryDelay</span> <span class="o">=</span> <span class="nx">INITIAL_RETRY_DELAY</span><span class="p">;</span>

	<span class="k">for </span><span class="p">(</span><span class="kd">let</span> <span class="nx">attempt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">attempt</span> <span class="o">&lt;=</span> <span class="nx">maxRetries</span><span class="p">;</span> <span class="nx">attempt</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">try</span> <span class="p">{</span>
			<span class="k">return</span> <span class="k">await</span> <span class="nf">fetchFn</span><span class="p">();</span>
		<span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if </span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">429</span><span class="p">)</span> <span class="p">{</span>
				<span class="kd">const</span> <span class="nx">waitTime</span> <span class="o">=</span> <span class="nx">error</span><span class="p">.</span><span class="nx">retryAfter</span>
					<span class="p">?</span> <span class="nx">error</span><span class="p">.</span><span class="nx">retryAfter</span> <span class="o">*</span> <span class="mi">1000</span>
					<span class="p">:</span> <span class="nx">retryDelay</span><span class="p">;</span>
				<span class="k">await</span> <span class="k">new</span> <span class="nc">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nf">setTimeout</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">waitTime</span><span class="p">));</span>
				<span class="nx">retryDelay</span> <span class="o">*=</span> <span class="mi">2</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="preventing-spam">Preventing Spam</h3>

<p>I hate when websites make me sign up. I just want people to be able to submit recommendations, but I also didn’t want someone to flood the site with a 47-album playlist of “souljaboytellem.com.” So, I needed a rate-limiting system without asking the users to sign up.</p>

<p>I went with a combination of IP address and browser fingerprinting:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nf">generateSubmissionId</span><span class="p">(</span><span class="nx">ip</span><span class="p">,</span> <span class="nx">fingerprint</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">crypto</span>
		<span class="p">.</span><span class="nf">createHash</span><span class="p">(</span><span class="dl">"</span><span class="s2">sha256</span><span class="dl">"</span><span class="p">)</span>
		<span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="nx">ip</span> <span class="o">+</span> <span class="p">(</span><span class="nx">fingerprint</span> <span class="o">||</span> <span class="dl">""</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">IP_SALT</span> <span class="o">||</span> <span class="dl">""</span><span class="p">))</span>
		<span class="p">.</span><span class="nf">digest</span><span class="p">(</span><span class="dl">"</span><span class="s2">hex</span><span class="dl">"</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This creates a unique but anonymized identifier for each user. The salt means I can’t reverse-engineer the original data, and the one-way hash means the system is privacy-friendly while preventing abuse.</p>

<p>The rate limit resets every Monday at midnight UTC, which gives the site a nice weekly rhythm.</p>

<h3 id="the-playlist-creation-magic">The Playlist Creation Magic</h3>

<p>This part is my favorite. When someone submits an album, I don’t just store it in a database—I create a Spotify playlist on my account with all the tracks from that album.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="k">async</span> <span class="kd">function</span> <span class="nf">createAlbumPlaylist</span><span class="p">(</span><span class="nx">albumId</span><span class="p">,</span> <span class="nx">nickname</span><span class="p">,</span> <span class="nx">albumName</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">const</span> <span class="nx">api</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">getSpotifyApi</span><span class="p">();</span>

	<span class="c1">// get my user profile</span>
	<span class="kd">const</span> <span class="nx">me</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">api</span><span class="p">.</span><span class="nx">currentUser</span><span class="p">.</span><span class="nf">profile</span><span class="p">();</span>

	<span class="c1">// create playlist with format "nickname-album title"</span>
	<span class="kd">const</span> <span class="nx">playlistName</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">nickname</span><span class="p">}</span><span class="s2">-</span><span class="p">${</span><span class="nx">albumName</span><span class="p">}</span><span class="s2">`</span><span class="p">.</span><span class="nf">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
	<span class="kd">const</span> <span class="nx">playlist</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">api</span><span class="p">.</span><span class="nx">playlists</span><span class="p">.</span><span class="nf">createPlaylist</span><span class="p">(</span><span class="nx">me</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="p">{</span>
		<span class="na">name</span><span class="p">:</span> <span class="nx">playlistName</span><span class="p">,</span>
		<span class="na">description</span><span class="p">:</span> <span class="s2">`album recommendation from </span><span class="p">${</span><span class="nx">nickname</span><span class="p">}</span><span class="s2"> via bhav.fun`</span><span class="p">,</span>
		<span class="na">public</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
	<span class="p">});</span>

	<span class="c1">// get all tracks from the album</span>
	<span class="kd">const</span> <span class="nx">albumTracks</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">api</span><span class="p">.</span><span class="nx">albums</span><span class="p">.</span><span class="nf">tracks</span><span class="p">(</span><span class="nx">albumId</span><span class="p">);</span>

	<span class="c1">// add them to the playlist</span>
	<span class="k">if </span><span class="p">(</span><span class="nx">albumTracks</span><span class="p">.</span><span class="nx">items</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">const</span> <span class="nx">trackUris</span> <span class="o">=</span> <span class="nx">albumTracks</span><span class="p">.</span><span class="nx">items</span><span class="p">.</span><span class="nf">map</span><span class="p">((</span><span class="nx">track</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">track</span><span class="p">.</span><span class="nx">uri</span><span class="p">);</span>
		<span class="k">await</span> <span class="nx">api</span><span class="p">.</span><span class="nx">playlists</span><span class="p">.</span><span class="nf">addItemsToPlaylist</span><span class="p">(</span><span class="nx">playlist</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">trackUris</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="nx">playlist</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Which means every recommendation becomes an immediately playable playlist. I realize I have let the internet control my Spotify; there is a non-zero chance I wake up to my Spotify having a playlist called “Penis-Punisher.” But please don’t do that. I beg.</p>

<h2 id="architecture-nextjs--firebase--prayers">Architecture: Next.js + Firebase + Prayers</h2>

<p>The stack is pretty straightforward:</p>

<ul>
  <li><strong>Next.js</strong> for the frontend and API routes</li>
  <li><strong>Firebase Firestore</strong> for storing submissions</li>
  <li><strong>Spotify Web API</strong> for everything music-related</li>
  <li><strong>Vercel</strong> for hosting</li>
</ul>

<p>I organized it around clear separation of concerns:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>├── app/                  # Next.js pages and API routes
├── components/           # React components (all the cozy UI bits)
├── lib/                  # Services and utilities
│   ├── spotify-service.js     # All Spotify API interactions
│   ├── firebase-service.js    # Database operations
│   ├── fingerprint-service.js # Rate limiting
│   └── url-utils.js           # Input validation and cleaning
</code></pre></div></div>

<p>The API design is RESTful but pragmatic. For example, the submission endpoint does the following:</p>

<ol>
  <li>Validate the rate limit</li>
  <li>Sanitizes inputs</li>
  <li>Validates Spotify URLs</li>
  <li>Fetches album details</li>
  <li>Create the playlist</li>
  <li>Stores everything in the database</li>
</ol>

<p>It’s not the most “pure” API design, but it works well for this use case where each submission is a complex multi-step operation.</p>

<h2 id="some-interesting-problems-i-solved">Some Interesting Problems I Solved</h2>

<h3 id="dynamic-album-cards">Dynamic Album Cards</h3>

<p>I wanted album cards that could dynamically load their artwork and details from just a Spotify URL. This led to an interesting caching strategy where I cache both in-browser (localStorage) and server-side, with intelligent fallbacks when things go wrong.</p>

<h3 id="responsive-image-handling">Responsive Image Handling</h3>

<p>Album artwork comes in various sizes from Spotify, and I needed it to look good across devices. Next.js’s Image component helped a lot, but I still had to handle edge cases like missing artwork:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">&lt;</span><span class="nc">Image</span>
	<span class="na">src</span><span class="p">=</span><span class="si">{</span><span class="nx">albumImage</span> <span class="o">||</span> <span class="dl">"</span><span class="s2">/images/album-placeholder.jpg</span><span class="dl">"</span><span class="si">}</span>
	<span class="na">alt</span><span class="p">=</span><span class="si">{</span><span class="s2">`Album cover: </span><span class="p">${</span><span class="nx">albumName</span><span class="p">}</span><span class="s2"> by </span><span class="p">${</span><span class="nx">artistName</span><span class="p">}</span><span class="s2">`</span><span class="si">}</span>
	<span class="na">width</span><span class="p">=</span><span class="si">{</span><span class="mi">300</span><span class="si">}</span>
	<span class="na">height</span><span class="p">=</span><span class="si">{</span><span class="mi">300</span><span class="si">}</span>
	<span class="na">quality</span><span class="p">=</span><span class="si">{</span><span class="mi">85</span><span class="si">}</span>
	<span class="na">placeholder</span><span class="p">=</span><span class="s">"blur"</span>
	<span class="na">blurDataURL</span><span class="p">=</span><span class="s">"data:image/svg+xml,..."</span>
	<span class="na">onError</span><span class="p">=</span><span class="si">{</span><span class="nx">onImageError</span><span class="si">}</span>
<span class="p">/&gt;</span>
</code></pre></div></div>

<h3 id="the-now-playing-feature">The “Now Playing” Feature</h3>

<p>I quickly realized this was slightly more nuanced than expected because Spotify’s “currently playing” endpoint doesn’t always have data. So I fall back to “recently played” and show that instead, with appropriate labeling. It makes the site feel more alive and personal.</p>

<h2 id="the-unexpected-joy-of-building-something-small">The Unexpected Joy of Building Something Small</h2>

<figure>
  <img src="/assets/images/blog/the-zen-of-python.png" alt="Zen of Python by Tim Peters" />
  <figcaption>The Zen of Python</figcaption>
</figure>

<p>One of the most rewarding aspects of this project was its scope. I built and shipped the MVP in two days, and it immediately felt proper and complete. There’s something deeply satisfying about creating a tool that solves exactly one problem well.</p>

<p>It also forced me to make decisions quickly. Should I build user accounts? Should I add social features? Should I integrate with other music services? For now, the answer to all of these is “no,” and that simplicity is part of what makes the site charming.</p>

<h2 id="some-technical-details-you-might-care-about">Some Technical Details You Might Care About</h2>

<p><strong>Security:</strong> All user inputs are sanitized, URLs are validated to ensure they’re actually Spotify links, and the rate-limiting system is designed to be privacy-friendly.</p>

<p><strong>Performance:</strong> Album details are cached aggressively, images are optimized with Next.js’s Image component, and the Spotify API calls include retry logic and error handling.</p>

<p><strong>Accessibility:</strong> I tried to follow best practices, such as semantic HTML, proper focus management, alt text for images, and keyboard navigation support.</p>

<p><strong>SEO:</strong> The site has proper meta tags, a sitemap, and structured data to help with discovery.</p>

<h2 id="whats-next">What’s Next</h2>

<p>As sad as it is, my hyper fixation on this site has worn off, but I’m sure I will revisit this, and when I do, I’d like to make:</p>

<ul>
  <li>Better error handling for edge cases</li>
  <li>More granular caching strategies</li>
  <li>Maybe a Grand Spotify playlist that’s automatically updated with all submissions</li>
</ul>

<p>But I’m pretty happy with it as it is. Sometimes, the best software is the kind that does exactly what it says it will do without trying to be everything to everyone.</p>

<h2 id="try-it-out">Try It Out</h2>

<p>You can check out <a href="https://bhav.fun/">Album Exchange</a> yourself. Please submit an album you love, browse what others have recommended, or look around the source code on <a href="https://github.com/codebhav/album-exchange">GitHub</a>.</p>

<p>And if you build something similar or have ideas for improvements, <a href="https://whybhav.in/contact/">I’d love to hear about it</a>. The best part of sharing projects like this is the conversations they start.</p>
</div>
	 <section class="comments-section">
	<h2>comments</h2>
	<script
		src="https://utteranc.es/client.js"
		repo="codebhav/codebhav.github.io"
		issue-term="pathname"
		label="comment"
		theme="github-light"
		crossorigin="anonymous"
		async
	></script>
</section>
 
</article>
</main>
			<footer class="site-footer">
	<div class="footer-content">
		<p>
			opinions and views shared here are solely my own and do not
			represent the views of my university or employers.
		</p>
		<p>
			all forms of media here are released under
			<a
				href="https://creativecommons.org/licenses/by/4.0/"
				target="_blank"
				>(CC BY 4.0)</a
			>
			• source code
			<a
				href="https://github.com/codebhav/codebhav.github.io"
				target="_blank"
				>available here</a
			>, released under the MIT license
		</p>
		<p>
			built on: 2025-06-08T05:47:16Z • commit: 199e339
		</p>
	</div>
</footer>

		</div>
		<script src="/assets/js/oneko.js"></script>
		<script
			src="/assets/js/mobile-menu.js"
			defer
		></script>
	</body>
</html>
